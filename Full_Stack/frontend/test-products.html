<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        #productsGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Products Functionality Test</h1>
    <div id="testResults"></div>
    <div id="productsGrid"></div>

    <!-- Load the same scripts as products.html -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/products.js"></script>
    <script src="js/app.js"></script>

    <script>
        let testResults = [];

        function addTestResult(message, type = 'info') {
            testResults.push({ message, type });
            updateTestDisplay();
        }

        function updateTestDisplay() {
            const container = document.getElementById('testResults');
            container.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.type}">${result.message}</div>`
            ).join('');
        }

        // Wait for everything to load
        setTimeout(() => {
            console.log('=== PRODUCTS TEST STARTING ===');
            addTestResult('Starting products functionality test...', 'info');

            // Test 1: Check if API is available
            if (window.api) {
                addTestResult('✅ API service is available', 'success');
                
                // Test API connection
                window.api.getProducts({})
                    .then(response => {
                        addTestResult(`✅ API connection successful. Found ${response.products ? response.products.length : 0} products`, 'success');
                        
                        // Test 2: Check if ProductsManager is available
                        if (typeof ProductsManager !== 'undefined') {
                            addTestResult('✅ ProductsManager class is available', 'success');
                            
                            // Test 3: Create ProductsManager instance
                            try {
                                const testProducts = new ProductsManager();
                                addTestResult('✅ ProductsManager instance created successfully', 'success');
                                
                                // Test 4: Check if products instance is in window
                                if (window.products) {
                                    addTestResult('✅ Global products instance is available', 'success');
                                } else {
                                    addTestResult('⚠️ Global products instance not found, creating one...', 'info');
                                    window.products = testProducts;
                                }
                                
                                // Test 5: Try to render products
                                if (response.products && response.products.length > 0) {
                                    testProducts.renderProducts(response.products);
                                    addTestResult('✅ Products rendered successfully', 'success');
                                } else {
                                    addTestResult('⚠️ No products to render', 'info');
                                }
                                
                            } catch (error) {
                                addTestResult(`❌ Error creating ProductsManager: ${error.message}`, 'error');
                            }
                        } else {
                            addTestResult('❌ ProductsManager class is not defined', 'error');
                        }
                    })
                    .catch(error => {
                        addTestResult(`❌ API connection failed: ${error.message}`, 'error');
                    });
            } else {
                addTestResult('❌ API service is not available', 'error');
            }

            // Test auth
            if (window.auth) {
                addTestResult('✅ Auth service is available', 'success');
            } else {
                addTestResult('❌ Auth service is not available', 'error');
            }

            // Test cart
            if (window.cart) {
                addTestResult('✅ Cart service is available', 'success');
            } else {
                addTestResult('❌ Cart service is not available', 'error');
            }

        }, 2000);
    </script>
</body>
</html>
